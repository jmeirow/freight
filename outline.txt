


JOURNAL UPDATE PROCESS

Assumes processing of a single member:

* get all freight members
* for each freight member

  * get previous allocation period (PAP) FBs

  * for each prior allocation period with FB:
      for each FB in that allocation period
        compute deletions for *this* FB  (that is to say, deletions of CHs that were credited to the account prior to granting the FB. If a CH that came after is deleted, it does not matter)
        increment the cumulative "damages" for that FB by the amount of the CH
      end
    end

    SANDIE - CAN THESE EVEN HAPPEN? (AFTER THE FACT CH's? )
  * for each prior allocation period with and FB that has damages:
      for each FB with damages in that allocation period
        compute additions for *this* FB  (that is to say, additions of CHs with effective dates prior to the FB w/ damages
        reduce the cumulative "damages" for that FB by the amount of the CH
      end
    end


  
Current Allocation Period Processing


* compute CAP deletions
  for each CAP deletion
    if effective date of deletion is prior to an FB, increment damages to that FB (the first FB on or following that effective date)
    post deletion to account
  end


* compute CAP additions
  for each CAP additions
    if effective date of addition is prior to an FB,  decrement damges to that FB (the first FB on or following that effectiev date)
    post addition to account 
  end

 


CREATE STATEMENTS

  QUESTION:  SHOW *ONLY* ACTIVITY WITH EFFECTIVE DATES IN THE CURRENT ALLOCATION PERIOD
  

  get balance from last period 

	get activity (effective date) since last statement  

  show net change (sum of activity)

	get current benefit package and rate (based on tier)

	get current balance

	if current balance > amount needed
		add line to statement (FB earned)


	- Determine if an FB can be applied
		get eligibility
		if any gaps > statement date + 1 week
			record FB for that date (FB table)
			add line to statement (FB used)
    end






	



























